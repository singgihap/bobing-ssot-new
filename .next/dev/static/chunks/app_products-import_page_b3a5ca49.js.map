{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Bobing%20Corp/Desktop/bobing-ssot-new/app/products-import/page.js"],"sourcesContent":["// app/products-import/page.js\r\n\"use client\";\r\nimport { useState } from 'react';\r\nimport { db } from '@/lib/firebase';\r\nimport { collection, getDocs, addDoc, serverTimestamp, query, where } from 'firebase/firestore';\r\nimport * as XLSX from 'xlsx';\r\n\r\nexport default function ImportProductsPage() {\r\n    const [logs, setLogs] = useState([]);\r\n    const [processing, setProcessing] = useState(false);\r\n\r\n    const addLog = (msg, type='info') => setLogs(prev => [...prev, {msg, type}]);\r\n\r\n    const handleFile = async (e) => {\r\n        const file = e.target.files[0];\r\n        if(!file) return;\r\n        setProcessing(true);\r\n        setLogs([]);\r\n\r\n        try {\r\n            addLog(\"Memuat data master...\", \"info\");\r\n            const brandsSnap = await getDocs(collection(db, \"brands\"));\r\n            const brandsMap = {}; brandsSnap.forEach(d => brandsMap[d.data().name.toLowerCase()] = d.id);\r\n\r\n            const prodsSnap = await getDocs(collection(db, \"products\"));\r\n            const prodMap = {}; prodsSnap.forEach(d => prodMap[d.data().base_sku.toUpperCase()] = d.id);\r\n\r\n            const reader = new FileReader();\r\n            reader.onload = async (ev) => {\r\n                const wb = XLSX.read(ev.target.result, {type:'array'});\r\n                const rows = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]);\r\n                \r\n                addLog(`Mendeteksi ${rows.length} baris data.`, \"info\");\r\n                \r\n                let success = 0;\r\n                for (const row of rows) {\r\n                    try {\r\n                        const baseSku = String(row['base_sku']||'').toUpperCase().trim();\r\n                        const prodName = row['product_name'];\r\n                        if(!baseSku || !prodName) continue;\r\n\r\n                        let brandId = null;\r\n                        if(row['brand']) {\r\n                            const bName = row['brand'].trim();\r\n                            const bKey = bName.toLowerCase();\r\n                            if(brandsMap[bKey]) brandId = brandsMap[bKey];\r\n                            else {\r\n                                const bRef = await addDoc(collection(db, \"brands\"), { name: bName, type: 'supplier_brand', created_at: serverTimestamp() });\r\n                                brandId = bRef.id; brandsMap[bKey] = brandId;\r\n                                addLog(`Brand Baru: ${bName}`, \"success\");\r\n                            }\r\n                        }\r\n\r\n                        let prodId = prodMap[baseSku];\r\n                        if(!prodId) {\r\n                            const pRef = await addDoc(collection(db, \"products\"), {\r\n                                base_sku: baseSku, name: prodName, brand_id: brandId, \r\n                                category: row['category']||'Uncategorized', status: 'active', created_at: serverTimestamp()\r\n                            });\r\n                            prodId = pRef.id; prodMap[baseSku] = prodId;\r\n                            addLog(`Produk Baru: ${prodName}`, \"success\");\r\n                        }\r\n\r\n                        const color = String(row['color']||'STD').toUpperCase().replace(/\\s+/g, '-');\r\n                        const size = String(row['size']||'ALL').toUpperCase().replace(/\\s+/g, '-');\r\n                        const sku = `${baseSku}-${color}-${size}`;\r\n                        \r\n                        const qVar = query(collection(db, \"product_variants\"), where(\"sku\", \"==\", sku));\r\n                        const sVar = await getDocs(qVar);\r\n                        \r\n                        if(sVar.empty) {\r\n                            await addDoc(collection(db, \"product_variants\"), {\r\n                                product_id: prodId, sku, color, size, \r\n                                cost: parseInt(row['cost']||0), price: parseInt(row['price']||0),\r\n                                weight: parseInt(row['weight']||0), status: 'active', created_at: serverTimestamp()\r\n                            });\r\n                            addLog(`+ Varian: ${sku}`, \"success\");\r\n                            success++;\r\n                        }\r\n                    } catch(err) { console.error(err); addLog(`Error baris: ${err.message}`, \"error\"); }\r\n                }\r\n                addLog(`Selesai. ${success} varian ditambahkan.`, \"info\");\r\n                setProcessing(false);\r\n            };\r\n            reader.readAsArrayBuffer(file);\r\n\r\n        } catch(e) { addLog(e.message, \"error\"); setProcessing(false); }\r\n    };\r\n\r\n    return (\r\n        <div className=\"max-w-2xl mx-auto space-y-6 fade-in\">\r\n            <div className=\"card-luxury p-6 bg-lumina-surface border-lumina-border\">\r\n                <h2 className=\"text-xl font-bold text-lumina-text mb-4 font-display\">Import Products & Variants</h2>\r\n                <div className=\"border-2 border-dashed border-lumina-border rounded-xl p-8 text-center bg-lumina-base/50 hover:bg-lumina-base transition-colors cursor-pointer relative group\">\r\n                    <input type=\"file\" accept=\".csv, .xlsx\" onChange={handleFile} disabled={processing} className=\"absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10\" />\r\n                    <div className=\"pointer-events-none relative z-0\">\r\n                        <div className=\"w-12 h-12 bg-lumina-highlight rounded-lg flex items-center justify-center mx-auto mb-3 group-hover:scale-110 transition-transform\">\r\n                            <svg className=\"w-6 h-6 text-lumina-gold\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12\"/></svg>\r\n                        </div>\r\n                        <p className=\"text-sm font-bold text-lumina-text\">Click to upload file</p>\r\n                        <p className=\"text-xs text-lumina-muted mt-1\">Supported: .xlsx, .csv</p>\r\n                        <p className=\"text-[10px] text-lumina-muted/60 mt-2 font-mono\">Format: base_sku, product_name, brand, category, color, size, cost, price</p>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            \r\n            {/* Console Log Terminal */}\r\n            <div className=\"bg-[#0B0C10] p-4 rounded-xl border border-lumina-border h-64 overflow-y-auto font-mono text-xs shadow-inner\">\r\n                <div className=\"flex items-center gap-2 mb-3 border-b border-lumina-border pb-2\">\r\n                    <div className=\"w-2 h-2 rounded-full bg-red-500\"></div>\r\n                    <div className=\"w-2 h-2 rounded-full bg-yellow-500\"></div>\r\n                    <div className=\"w-2 h-2 rounded-full bg-green-500\"></div>\r\n                    <span className=\"text-lumina-muted ml-2\">Import Terminal</span>\r\n                </div>\r\n                <div className=\"space-y-1\">\r\n                    {logs.length === 0 ? (\r\n                        <span className=\"text-lumina-muted/50 animate-pulse\">Waiting for file...</span>\r\n                    ) : logs.map((l, i) => (\r\n                        <div key={i} className={`flex gap-2 ${l.type==='error'?'text-rose-400':(l.type==='success'?'text-emerald-400':'text-lumina-muted')}`}>\r\n                            <span className=\"opacity-50 select-none\">{'>'}</span>\r\n                            <span>{l.msg}</span>\r\n                        </div>\r\n                    ))}\r\n                    {processing && <div className=\"text-lumina-gold animate-pulse mt-2\">_ Processing data...</div>}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}"],"names":[],"mappings":"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"}}]
}